name: ğŸš€ Update GitHub Metrics

on:
  # Executa toda segunda e quinta
  schedule:
    - cron: '0 8 * * 1,4'
  # Executa manualmente
  workflow_dispatch:
  # Executa quando vocÃª fizer push
  push:
    branches: [ main ]

permissions:
  contents: write

jobs:
  update-metrics:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: true  # IMPORTANTE!

      - name: ğŸ“Š Generate GitHub Stats Image
        run: |
          # Criar pasta para imagens
          mkdir -p metrics-images
          
          # Baixar imagem das linguagens
          curl -o metrics-images/languages.png "https://github-readme-stats.vercel.app/api/top-langs/?username=MarcoTuliops22&layout=compact&theme=tokyonight&hide_border=true&langs_count=6"
          
          # Baixar imagem das estatÃ­sticas
          curl -o metrics-images/stats.png "https://github-readme-stats.vercel.app/api?username=MarcoTuliops22&show_icons=true&theme=tokyonight&hide_border=true"

      - name: ğŸ“ Update README with Metrics
        run: |
          # Criar seÃ§Ã£o de mÃ©tricas no README
          METRICS_SECTION='## ğŸ“Š MÃ©tricas do GitHub\n\n<div align="center">\n\n![EstatÃ­sticas](metrics-images/stats.png)\n\n![Linguagens](metrics-images/languages.png)\n\n</div>\n\n*Ãšltima atualizaÃ§Ã£o: $(date "+%d/%m/%Y %H:%M")*'
          
          # Se o README jÃ¡ existir, atualiza. Se nÃ£o, cria.
          if [ -f README.md ]; then
            # Remove seÃ§Ã£o anterior se existir
            sed -i '/## ğŸ“Š MÃ©tricas do GitHub/,/*Ãšltima atualizaÃ§Ã£o:/d' README.md
            echo -e "\n$METRICS_SECTION" >> README.md
          else
            echo "$METRICS_SECTION" > README.md
          fi

      - name: ğŸ’¾ Commit and Push Changes
        run: |
          git config --local user.name "GitHub Action"
          git config --local user.email "action@github.com"
          git add .
          git commit -m "ğŸ“ˆ Atualizar mÃ©tricas - $(date '+%d/%m/%Y')" || echo "Sem alteraÃ§Ãµes para commitar"
          git push