name: Update README Badges

on:
  workflow_dispatch:
  schedule:
    - cron: '0 10 * * *'

jobs:
  update-badges:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Get stats
        id: stats
        run: |
          # Usar API do GitHub para pegar estatÃ­sticas
          response=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/users/MarcoTuliops22")
          
          public_repos=$(echo $response | jq -r '.public_repos')
          total_stars=$(curl -s "https://api.github.com/users/MarcoTuliops22/repos?per_page=100" \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" | \
            jq '.[].stargazers_count' | awk '{s+=$1} END {print s}')
          
          echo "public_repos=$public_repos" >> $GITHUB_OUTPUT
          echo "total_stars=$total_stars" >> $GITHUB_OUTPUT
          
      - name: Update README with badges
        run: |
          # Ler README
          content=$(cat README.md)
          
          # Criar badges atualizados
          badges="![Total Repos](https://img.shields.io/badge/RepositÃ³rios-${{ steps.stats.outputs.public_repos }}-blue) "
          badges+="![Total Stars](https://img.shields.io/badge/Estrelas-${{ steps.stats.outputs.total_stars }}-yellow) "
          badges+="![Updated](https://img.shields.io/badge/Atualizado-$(date +'%d/%m/%Y')-green)"
          
          # Substituir linha de badges existente ou adicionar nova
          if echo "$content" | grep -q "!\[Total Repos\]"; then
            # Atualizar linha existente
            new_content=$(echo "$content" | sed "s|!\[Total Repos\].*|$badges|")
          else
            # Adicionar apÃ³s o primeiro bloco
            new_content=$(echo "$content" | sed "/^---$/a\\
\\
$badges")
          fi
          
          echo "$new_content" > README.md
          
      - name: Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add README.md
          git commit -m "ðŸ”„ Atualizar badges no README" || exit 0
          git push
